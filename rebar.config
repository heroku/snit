%% -*- erlang -*-
{erl_opts,
 [
  warnings_as_errors,
  debug_info,
  {platform_define, "^[0-9]+", namespaced_types},
  {parse_transform, lager_transform}
 ]}.

{deps,
 [
  {ranch, [], {git, "git@github.com:heroku/ranch.git", {branch, "sni"}}},
  {lager, [], {git, "git@github.com:basho/lager.git", {branch, "master"}}},
  {lager, [], {git, "git@github.com:bigkevmcd/erlfernet.git", {branch, "master"}}},
  {bitcask, [], {git, "git@github.com:basho/bitcask.git", {branch, "develop"}}}
]}.

{profiles, [
            {test, [{deps,
                     [
                      {meck, [],
                       {git, "git@github.com:eproxus/meck.git",
                        {branch, "master"}}}
                     ]
                    },
                    %% work around rebar3 bug #549
                    {plugins,
                     [
                      {pc, {git, "git@github.com:blt/port_compiler.git",
                            {branch, "master"}}}
                     ]},
                    {provider_hooks,
                     [
                      {post,
                       [
                            {compile, {pc, compile}},
                        {clean, {pc, clean}}
                       ]
                      }]
                    },
                    {overrides,
                     [
                      {override, bitcask,
                       [
                        {erl_opts,
                         [warnings_as_errors,
                          debug_info,
                          {platform_define, "^[0-9]+", namespaced_types},
                          {parse_transform, lager_transform}
                         ]},
                        {plugins,
                         [
                          {pc, {git, "git@github.com:blt/port_compiler.git",
                                {branch, "master"}}}
                         ]},
                        {provider_hooks,
                         [
                          {post,
                           [
                            {compile, {pc, compile}},
                            {clean, {pc, clean}}
                           ]
                          }]
                        }
                       ]}
                     ]},

                    {erl_opts, [debug_info,
                                warnings_as_errors,
                                {parse_transform, lager_transform}]}                   ]
            }
           ]
}.

{overrides,
 [
  {override, bitcask,
   [
    {erl_opts,
     [warnings_as_errors,
      debug_info,
      {platform_define, "^[0-9]+", namespaced_types},
      {parse_transform, lager_transform}
     ]},
    {plugins,
     [
      {pc, {git, "git@github.com:blt/port_compiler.git", {branch, "master"}}}
     ]},
    {provider_hooks,
     [
      {post,
       [
        {compile, {pc, compile}},
        {clean, {pc, clean}}
       ]
      }]
    }
   ]}
 ]}.
